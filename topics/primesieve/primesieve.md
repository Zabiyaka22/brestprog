---
layout: topic
title: Решето Эратосфена
permalink: topics/primesieve/
---

## Определение

Решето Эратосфена - достаточно эффективный алгоритм для нахождения
*всех* простых чисел в отрезке от $$1$$ до $$N$$ за $$O(N \log \log N)$$.

Алгоритм достаточно тривиален: будем перебирать числа по возрастанию,
начиная с $$2$$, зачёркивая все числа, кратные текущему. Например, при обработке
числа $$2$$ будут зачёркнуты числа $$4, 6, 8, \ldots$$. Если мы обнаружили
незачёркнутое число, это значит, что оно простое.

Визуализация работы решета Эратосфена:

![Решето Эратосфена](eratosthenes.gif)

Работу решета можно значительно ускорить, если начинать зачёркивать
числа, кратные $$p$$, не с $$2p$$, а с $$p^2$$. Ведь числа $$2p, 3p, 5p, \ldots$$ уже
были зачёркнуты при обработке чисел $$2, 3, 5, \ldots$$

## Реализация

{% highlight cpp linenos %}
#include <bits/stdc++.h>

using namespace std;

bool sieve[1000001];    //решето
vector<int> primes;     //вектор, в который будут добавляться простые числа

void compute_primes(int n) {
    for (int i = 2; i <= n; i++) {   //Изначально все числа не вычеркнуты.
        sieve[i] = true;
    }

    for (int i = 2; i <= n; i++) {
        if (sieve[i]) {     //если i не вычеркнуто
            primes.push_back(i);

            for (int j = i * i; j <= n; j += i) {    //вычеркиваем все кратные числа начиная с i^2
                sieve[j] = false;
            }
        }
    }
}

int main() {
    compute_primes(1000000);

    cout << "Prime numbers: ";
    for (int i: primes) {
        cout << i << ", ";
    }
}
{% endhighlight %}

## Доказательство оценки времени работы

Докажем, что при поиске простых чисел в интервале $$[1..N]$$ мы затратим количество времени пропорциональное $$O(N \log \log N)$$
Для начала докажем менее строгую оценку асимптотики, а конкретно то, что асимптотика решета Эратосфена всегда меньше чем $$O(N \log N)$$
Рассмотрим сколько операций алгоритм производит при каждом $$P$$.
При $$P = 2$$ мы проходим через каждое чётное число в интервале $$[1..N]$$, таких чисел $$N/2$$.
При $$P = 3$$ мы проходим через каждое число, кратное трём в интервале $$[1..N]$$, таких чисел $$N/3$$.
Продолжая далее до $$N$$ получаем сумму количества операций 
$$(N/2 + N/3 + N/4 + \ldots + N/N) = N(1/2 + 1/3 + 1/4 + \ldots + 1/N)$$. Слагаемое в скобках теперь представляет собой сумму гармонического ряда, которая примерно равна $$\ln N$$(доказательство можно найти в соответствующей статье Википедии).
Итого сумма количества операций равна: $$N \log N$$ и асимтотика соответственно $$O(N \log N)$$
Для того, чтобы итоговая асимптотика стала равна $$ O(N \log \log N) нужно зачёркивать числа кратные данному, только если данное число простое. Получаем следующую величину $$N(1/2 + 1/3 + 1/5 + 1/7 + 1/11 +  \ldots + 1/y)$$, где $$y$$ - наибольшее простое число, не превосходящее $$N$$. При помощи сложной математики можно показать, что эта сумма примерно равна $$N \log \log N$$  
Таким образом, решето Эратосфена использует $$O(N \log \log N)$$ времени и $$O(N)$$ памяти.
